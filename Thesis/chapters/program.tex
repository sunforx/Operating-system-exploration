\chapter{主要程序代码} %附录二

\section{初始启动程序代码（ipl09.nas）节选}
\label{sec:ipl09.nas}
\begin{listing}[H]
  \inputminted[tabsize=2, firstline=12, lastline=29,
  linenos=true]{nasm}{../ZOS/src/kernel/ipl09.nas}
  \caption{FAT12格式磁盘专用代码}
  \label{sec:fat12}
\end{listing}

\begin{listing}[H]
  \inputminted[tabsize=2, firstline=76, lastline=88,
  linenos=true]{nasm}{../ZOS/src/kernel/ipl09.nas}
  \caption{将磁盘内容读入内存}
  \label{sec:read}
\end{listing}

\begin{listing}[H]
  \inputminted[tabsize=2, firstline=138, lastline=147,
  linenos=true]{nasm}{../ZOS/src/kernel/ipl09.nas}
  \caption{读取磁盘数据到内存}
  \label{sec:readfrag}
\end{listing}

\section{内存管理程序代码（memory.c）节选}

\begin{listing}[H]
  \inputminted[tabsize=2, firstline=68, lastline=78,
  linenos=true]{c}{../ZOS/src/kernel/memory.c}
  \caption{分配内存}
  \label{lst:alloc}
\end{listing}

\begin{listing}[H]
  \inputminted[tabsize=2, firstline=91, lastline=95,
  linenos=true]{c}{../ZOS/src/kernel/memory.c}
  \caption{确定采取何种方式释放内存}
  \label{lst:rw}
\end{listing}

\begin{listing}[H]
  \inputminted[tabsize=2, firstline=98, lastline=116,
  linenos=true]{c}{../ZOS/src/kernel/memory.c}
  \caption{前端可用}
  \label{lst:mem1}
\end{listing}

\begin{listing}[H]
  \inputminted[tabsize=2, firstline=118, lastline=127,
  linenos=true]{c}{../ZOS/src/kernel/memory.c}
  \caption{后端空闲}
  \label{lst:mem2}
\end{listing}

\begin{listing}[H]
  \inputminted[tabsize=2, firstline=128, lastline=141,
  linenos=true]{c}{../ZOS/src/kernel/memory.c}
  \caption{前端后端均被占用}
  \label{lst:mem3}
\end{listing}

\begin{listing}[H]
  \inputminted[tabsize=2, firstline=151, lastline=151,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \inputminted[tabsize=2, firstline=161, lastline=162,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \inputminted[tabsize=2, firstline=171, lastline=171,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \inputminted[tabsize=2, firstline=177, lastline=177,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \inputminted[tabsize=2, firstline=180, lastline=180,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \inputminted[tabsize=2, firstline=189, lastline=201,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \inputminted[tabsize=2, firstline=206, lastline=206,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \inputminted[tabsize=2, firstline=211, lastline=211,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \inputminted[tabsize=2, firstline=216, lastline=216,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \inputminted[tabsize=2, firstline=227, lastline=227,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \inputminted[tabsize=2, firstline=237, lastline=243,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \caption{键盘输入}
  \label{lst:kbd}
\end{listing}

\begin{listing}[H]
  \inputminted[tabsize=2, firstline=247, lastline=266,
  linenos=true]{c}{../ZOS/src/kernel/bootpack.c}
  \caption{鼠标输入}
  \label{lst:ms}
\end{listing}

\begin{listing}[H]
  \inputminted[tabsize=2, firstline=185, lastline=203,
  linenos=true]{c}{../ZOS/src/kernel/mtask.c}
  \caption{多任务切换}
  \label{lst:mulsw}
\end{listing}